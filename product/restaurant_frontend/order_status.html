<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order Status</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 40px;
        }
        .card {
            background: #fff;
            padding: 20px;
            max-width: 500px;
            margin: auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .processing { color: orange; }
        .success { color: green; }
        .failed { color: red; }
        button {
            padding: 10px 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ§¾ Order Status</h2>

    <p><b>Order ID:</b> <span id="orderId">123</span></p>

    <p id="statusText">Checking status...</p>

    <button onclick="checkStatus()">ğŸ”„ Refresh</button>
</div>

<script>
    const orderId = 123; // ğŸ” dynamically set karo
    const token = "PASTE_JWT_TOKEN_HERE"; // ğŸ” user ka access token

    let pollingInterval = null;

    async function checkStatus() {
        document.getElementById("statusText").innerText = "Checking status...";

        try {
            const response = await fetch(`/api/orders/status/${orderId}/`, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                }
            });

            const data = await response.json();

            handleResponse(response.status, data);

        } catch (error) {
            document.getElementById("statusText").innerText =
                "âŒ Network error. Try again.";
        }
    }

    function handleResponse(statusCode, data) {
        const statusEl = document.getElementById("statusText");

        if (statusCode === 202 && data.status === "processing") {
            statusEl.className = "processing";
            statusEl.innerText = "â³ Payment is processing...";

            // auto polling start
            if (!pollingInterval) {
                pollingInterval = setInterval(checkStatus, 5000);
            }
            return;
        }

        // stop polling
        if (pollingInterval) {
            clearInterval(pollingInterval);
            pollingInterval = null;
        }

        if (data.status === "failed") {
            statusEl.className = "failed";
            statusEl.innerText = "âŒ Payment Failed";
            return;
        }

        if (data.status === "success") {
            statusEl.className = "success";
            statusEl.innerHTML = `
                âœ… Order Confirmed <br>
                ğŸ’³ Payment ID: ${data.payment_id} <br>
                ğŸ’° Amount: â‚¹${data.amount} <br>
                ğŸ§¾ Invoice: ${data.invoice_available ? "Available" : "Generating..."}
            `;
        }
    }

    // page load par auto check
    checkStatus();
</script>

</body>
</html>
